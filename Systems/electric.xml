<system name="electric">

	<property value="0">electric/external-connected</property>  <!-- if the external ground cart is connected -->
	<property value="0">electric/battery-mode</property>		<!-- 0 = batteries in parallel, 1 = batteries in series -->
	<property value="0">electric/busses/bus-switch[0]</property>
	<property value="0">electric/busses/bus-switch[1]</property>
	<property value="0">electric/busses/bus-switch[2]</property>

	<channel name="sources">
	
		<!-- 
			sources of electricity are:
			an external ground cart provides DC and AC
			dc generator
			ac alternator
			two batteries in either series or parallel
		-->
		
		<!-- dc generator -->
		
		<fcs_function name="trash/electric/sources/dc-gen">
			<function>
				<ifthen>
					<property>electric/external-connected</property>
					<value>29.0</value>
					<table>
						<independentVar lookup="row">propulsion/engine[0]/n1</independentVar>
						<tableData>
							0.0	 0.0
							30.0	25.0
							100.0   29.0
						</tableData>
					</table>
				</ifthen>
			</function>
			<output>electric/sources/dc-gen</output>
		</fcs_function>
		
		<!-- ac generator -->
		
		<fcs_function name="trash/electric/sources/ac-gen">
			<function>
				<ifthen>
					<property>electric/external-connected</property>
					<value>115.0</value>
					<table>
						<independentVar lookup="row">propulsion/engine[0]/n1</independentVar>
						<tableData>
							0.0	 0.0
							30.0	112.0
							100.0   116.0
						</tableData>
					</table>
				</ifthen>
			</function>
			<output>electric/sources/ac-volts</output>
		</fcs_function>
		
		<!-- battery #1 charge -->
		
		<!-- charge from dc gen -->
		<!-- the value of 25000 is the charge rate, bigger number is less charge -->
		<fcs_function name="trash/electric/sources/battery-dc-charge[0]">
			<function>
				<sum>
					<ifthen>
						<gt>
							<!-- ((dcg - bat) / 25000) -->
							<quotient>
								<difference>
									<property>electric/sources/dc-gen</property>
									<property>electric/sources/battery[0]</property>
								</difference>
								<value>25000</value>
							</quotient>
							<value>0.0</value>
						</gt>
						<quotient>
							<difference>
								<property>electric/sources/dc-gen</property>
								<property>electric/sources/battery[0]</property>
							</difference>
							<value>25000</value>
						</quotient>
						<value>0.0</value>
					</ifthen>
					<property>electric/sources/battery[0]</property>
				</sum>
			</function>
			<output>electric/sources/battery-dc-charge[0]</output>
		</fcs_function>
		
		<fcs_function name="trash/electric/sources/battery-dc-charge[1]">
			<function>
				<sum>
					<ifthen>
						<gt>
							<!-- ((dcg - bat) / 25000) -->
							<quotient>
								<difference>
									<property>electric/sources/dc-gen</property>
									<property>electric/sources/battery[1]</property>
								</difference>
								<value>25000</value>
							</quotient>
							<value>0.0</value>
						</gt>
						<quotient>
							<difference>
								<property>electric/sources/dc-gen</property>
								<property>electric/sources/battery[1]</property>
							</difference>
							<value>25000</value>
						</quotient>
						<value>0.0</value>
					</ifthen>
					<property>electric/sources/battery[1]</property>
				</sum>
			</function>
			<output>electric/sources/battery-dc-charge[1]</output>
		</fcs_function>
		
		<!-- cross charge from the other battery -->
		<!-- only if batteries are in parallel -->
		<fcs_function name="trash/electric/sources/battery[0]">
			<function>
				<ifthen>
					<property>electric/battery-mode</property>
					<property>electric/sources/battery-dc-charge[0]</property>
					<sum>
						<quotient>
							<difference>
								<property>electric/sources/battery-dc-charge[1]</property>
								<property>electric/sources/battery-dc-charge[0]</property>
							</difference>
							<value>25000</value>
						</quotient>
						<property>electric/sources/battery-dc-charge[0]</property>
					</sum>
				</ifthen>
			</function>
			<output>electric/sources/battery[0]</output>
		</fcs_function>
		
		<fcs_function name="trash/electric/sources/battery[1]">
			<function>
				<ifthen>
					<property>electric/battery-mode</property>
					<property>electric/sources/battery-dc-charge[1]</property>
					<sum>
						<quotient>
							<difference>
								<property>electric/sources/battery-dc-charge[0]</property>
								<property>electric/sources/battery-dc-charge[1]</property>
							</difference>
							<value>25000</value>
						</quotient>
						<property>electric/sources/battery-dc-charge[1]</property>
					</sum>
				</ifthen>
			</function>
			<output>electric/sources/battery[1]</output>
		</fcs_function>
		
		<!-- battery voltage should be average of both batteries in parallel
			or combined in serial. -->
		<fcs_function name="trash/electric/sources/battery-volts">
			<function>
				<ifthen>
					<property>electric/battery-mode</property>
					<sum>
						<property>electric/sources/battery[0]</property>
						<property>electric/sources/battery[1]</property>
					</sum>
					<avg>
						<property>electric/sources/battery[0]</property>
						<property>electric/sources/battery[1]</property>
					</avg>
				</ifthen>
			</function>
			<output>electric/sources/battery-volts</output>
		</fcs_function>
					
		
		<!-- final dc output -->
		
		<switch name="electric/sources/dc-volts">
			<default value="electric/sources/dc-gen"/>
			<test logic="AND" value="electric/sources/battery-volts">
				electric/sources/battery-volts gt electric/sources/dc-gen
			</test>
		</switch>
		
	</channel>
	
	<channel name="inverters">
		<!--
		inverters available
		PO-750A x 2	 115v
		PO-1500VT	   115v
		PT-500Ts		36v
		PT-125C		 36v
		-->
		
		<fcs_function name="trash/electric/inverters/po-750a[0]">
			<function>
				<table>
					<independentVar lookup="row">electric/sources/dc-volts</independentVar>
					<tableData>
						0.0	 0.0
						22.0	115.0
					</tableData>
				</table>
			</function>
			<output>electric/inverters/po-750a[0]</output>
		</fcs_function>
		
		<fcs_function name="trash/electric/inverters/po-750a[1]">
			<function>
				<table>
					<independentVar lookup="row">electric/sources/dc-volts</independentVar>
					<tableData>
						0.0	 0.0
						22.0	115.0
					</tableData>
				</table>
			</function>
			<output>electric/inverters/po-750a[1]</output>
		</fcs_function>
		
		<fcs_function name="trash/electric/inverters/po-1500vt">
			<function>
				<table>
					<independentVar lookup="row">electric/sources/dc-volts</independentVar>
					<tableData>
						0.0	 0.0
						22.0	115.0
					</tableData>
				</table>
			</function>
			<output>electric/inverters/po-1500vt</output>
		</fcs_function>
		
		<fcs_function name="trash/electric/inverters/pt-500ts">
			<function>
				<table>
					<independentVar lookup="row">electric/sources/dc-volts</independentVar>
					<tableData>
						0.0	 0.0
						22.0	36.0
					</tableData>
				</table>
			</function>
			<output>electric/inverters/pt-500ts</output>
		</fcs_function>
		
		<fcs_function name="trash/electric/inverters/pt-125c">
			<function>
				<table>
					<independentVar lookup="row">electric/sources/dc-volts</independentVar>
					<tableData>
						0.0	 0.0
						22.0	36.0
					</tableData>
				</table>
			</function>
			<output>electric/inverters/pt-125c</output>
		</fcs_function>
		
	</channel>
	
	<channel name="buses">
		<!-- 3 buses -->
		
		<switch name="electric/buses/bus[0]">
			<default value="0"/>
			<test logic="AND" value="electric/inverters/po-750a[0]">
				electric/busses/bus-switch[0] == 1
			</test>
		</switch>
		
		<switch name="electric/buses/bus[1]">
			<default value="0"/>
			<test logic="AND" value="electric/inverters/po-750a[1]">
				electric/busses/bus-switch[1] == 1
			</test>
		</switch>
		
		<switch name="electric/buses/bus[2]">
			<default value="0"/>
			<test logic="AND" value="electric/inverters/po-1500vt">
				electric/busses/bus-switch[2] == 1
			</test>
		</switch>
		
	</channel>
	
	<channel name="output">
	</channel>
	
</system>